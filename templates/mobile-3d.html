<!-- ============================================ -->
<!-- MOBILE-3D TEMPLATE - 3D Experience for Mobile -->
<!-- ============================================ -->

<!-- Intro UI Container (Transparent Background) -->
<div id="mobile-intro-ui">
  <div class="mobile-intro-overlay"></div>
  <div class="mobile-intro-content">
    <img src="assets/textures/logo.png" alt="Keplaar Esports Logo" class="mobile-intro-logo">
    <h1 class="mobile-intro-title">KEPLAAR ESPORTS</h1>
    <h2 class="mobile-intro-subtitle">Version 2.0 | Canada 2025</h2>
    <button id="mobile-enter-button" class="mobile-enter-btn">Enter Experience</button>
  </div>
</div>

<!-- Mobile Header (Hidden Initially) -->
<header id="mobile-header" style="display: none;">
  <div class="mobile-header-content">
    <!-- Top Row: Logo, Title and Hamburger - ALL IN ONE LINE -->
    <div class="mobile-header-top">
      <img src="assets/textures/logo.png" alt="Keplaar Esports" class="mobile-logo">
      
      <!-- Title in the middle -->
      <h1 class="mobile-title">KEPLAAR ESPORTS</h1>
      
      <!-- Hamburger Menu Button -->
      <button id="mobile-menu-toggle" class="hamburger" aria-label="Menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </div>
  
  <!-- Progress Bar -->
  <div class="mobile-progress-bar">
    <div class="mobile-progress-fill"></div>
  </div>
</header>

<!-- Hamburger Navigation Menu -->
<nav id="mobile-nav-menu" class="mobile-nav">
  <div class="mobile-nav-content">
    <!-- Navigation Links -->
    <div class="mobile-nav-links">
      <a href="#" class="mobile-nav-link active" data-screen="screen1">
        <span class="nav-icon">üéÆ</span>
        <span>Events</span>
      </a>
      <a href="#" class="mobile-nav-link" data-screen="screen2">
        <span class="nav-icon">‚ÑπÔ∏è</span>
        <span>About Us</span>
      </a>
      <a href="#" class="mobile-nav-link" data-screen="screen3">
        <span class="nav-icon">üë•</span>
        <span>Our Team</span>
      </a>
      <a href="#" class="mobile-nav-link" data-screen="screen4">
        <span class="nav-icon">üéÅ</span>
        <span>Giveaways</span>
      </a>
    </div>
    
    <!-- Social Media Section -->
    <div class="mobile-nav-social">
      <p class="social-title">Follow Us</p>
      <div class="social-links">
        <a href="#" class="social-link" data-platform="instagram" aria-label="Instagram">
          <img src="assets/icons/instagram.png" alt="Instagram">
        </a>
        <a href="#" class="social-link" data-platform="twitter" aria-label="Twitter">
          <img src="assets/icons/x.png" alt="Twitter/X">
        </a>
        <a href="#" class="social-link" data-platform="youtube" aria-label="YouTube">
          <img src="assets/icons/youtube.png" alt="YouTube">
        </a>
        <a href="#" class="social-link" data-platform="discord" aria-label="Discord">
          <img src="assets/icons/discord.png" alt="Discord">
        </a>
      </div>
    </div>
    
    <!-- Join Us Button -->
    <button id="mobile-show-form" class="mobile-join-btn">Join Our Team</button>
  </div>
</nav>

<!-- Menu Overlay -->
<div id="mobile-nav-overlay" class="nav-overlay"></div>

<!-- Application Form Modal -->
<div id="mobile-form-modal" class="mobile-modal" style="display: none;">
  <div class="modal-content">
    <button class="modal-close" aria-label="Close">&times;</button>
    <h2>Join Keplaar Esports</h2>
    <p class="form-subtitle">Apply to become part of our competitive team</p>
    
    <form id="mobile-application-form">
      <input type="text" name="name" placeholder="Full Name *" required>
      <input type="email" name="email" placeholder="Email *" required>
      <input type="tel" name="phone" placeholder="Phone *" required>
      
      <select name="game" required>
        <option value="">Select Game *</option>
        <option value="valorant">VALORANT</option>
        <option value="fortnite">Fortnite</option>
        <option value="dota2">Dota 2</option>
        <option value="pubg">PUBG</option>
      </select>
      
      <input type="text" name="rank" placeholder="Current Rank *" required>
      <input type="text" name="game_id" placeholder="In-Game ID *" required>
      
      <!-- File Upload Section -->
      <div class="mobile-file-upload">
        <label class="file-upload-label">Portfolio/Highlights (Optional)</label>
        <div class="file-upload-container">
          <div class="file-drop-zone" id="mobile3d-file-drop">
            <div class="drop-zone-content">
              <span class="file-icon">üìÑ</span>
              <span class="file-text">Tap to upload PDF</span>
              <span class="file-hint">Max 5MB</span>
            </div>
            <input type="file" 
                   id="mobile3d-portfolio" 
                   name="portfolio" 
                   accept=".pdf,.PDF" 
                   class="file-input-hidden">
          </div>
          
          <div class="file-preview" id="mobile3d-file-preview" style="display: none;">
            <span class="preview-icon">üìÑ</span>
            <div class="preview-info">
              <span class="preview-name" id="mobile3d-file-name"></span>
              <span class="preview-size" id="mobile3d-file-size"></span>
            </div>
            <button type="button" class="preview-remove" id="mobile3d-file-remove">‚úï</button>
          </div>
        </div>
      </div>
      
      <button type="submit" class="submit-button">Submit Application</button>
    </form>
  </div>
</div>

<!-- Debug Info (Remove in production) -->
<div id="debug-info" style="
  position: fixed;
  bottom: 10px;
  left: 10px;
  background: rgba(0,0,0,0.8);
  color: white;
  padding: 10px;
  font-size: 11px;
  border-radius: 5px;
  z-index: 10000;
  font-family: monospace;
  display: none;
">
  <div>Device: <span id="debug-device">-</span></div>
  <div>Performance: <span id="debug-perf">-</span></div>
  <div>Scroll: <span id="debug-scroll">0%</span></div>
  <div>Camera: <span id="debug-camera">intro</span></div>
</div>

<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/config/supabase.js"></script>

<!-- Inline Script for Basic Setup -->
<script>
console.log('üì± Mobile-3D template loaded');

// Show debug info if URL has ?debug=true
if (window.location.search.includes('debug=true')) {
  document.getElementById('debug-info').style.display = 'block';
  
  // Update debug info
  const updateDebug = () => {
    document.getElementById('debug-device').textContent = window.deviceDetector?.device || 'unknown';
    document.getElementById('debug-perf').textContent = window.deviceDetector?.performanceScore || '0';
  };
  
  setInterval(updateDebug, 1000);
}

// Basic hamburger toggle (enhanced by mobileUI.js later)
const hamburger = document.getElementById('mobile-menu-toggle');
const navMenu = document.getElementById('mobile-nav-menu');
const navOverlay = document.getElementById('mobile-nav-overlay');

if (hamburger && navMenu) {
  hamburger.addEventListener('click', () => {
    hamburger.classList.toggle('active');
    navMenu.classList.toggle('active');
    navOverlay.classList.toggle('active');
  });
  
  navOverlay.addEventListener('click', () => {
    hamburger.classList.remove('active');
    navMenu.classList.remove('active');
    navOverlay.classList.remove('active');
  });
}

// Form modal handlers (enhanced by formHandler.js later)
const showFormBtn = document.getElementById('mobile-show-form');
const formModal = document.getElementById('mobile-form-modal');
const closeFormBtn = formModal?.querySelector('.modal-close');

if (showFormBtn && formModal) {
  showFormBtn.addEventListener('click', () => {
    formModal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
    
    // Close menu
    hamburger?.classList.remove('active');
    navMenu?.classList.remove('active');
    navOverlay?.classList.remove('active');
  });
}

if (closeFormBtn) {
  closeFormBtn.addEventListener('click', () => {
    formModal.style.display = 'none';
    document.body.style.overflow = 'auto';
  });
}

if (formModal) {
  formModal.addEventListener('click', (e) => {
    if (e.target === formModal) {
      formModal.style.display = 'none';
      document.body.style.overflow = 'auto';
    }
  });
}

// ===== FILE UPLOAD HANDLER FOR MOBILE-3D =====
const mobile3dFileInput = document.getElementById('mobile3d-portfolio');
const mobile3dDropZone = document.getElementById('mobile3d-file-drop');
const mobile3dFilePreview = document.getElementById('mobile3d-file-preview');
const mobile3dFileName = document.getElementById('mobile3d-file-name');
const mobile3dFileSize = document.getElementById('mobile3d-file-size');
const mobile3dFileRemove = document.getElementById('mobile3d-file-remove');

if (mobile3dFileInput && mobile3dDropZone) {
  // Mobile-friendly: Make input overlay the drop zone
  mobile3dFileInput.style.position = 'absolute';
  mobile3dFileInput.style.top = '0';
  mobile3dFileInput.style.left = '0';
  mobile3dFileInput.style.width = '100%';
  mobile3dFileInput.style.height = '100%';
  mobile3dFileInput.style.opacity = '0';
  mobile3dFileInput.style.cursor = 'pointer';
  mobile3dDropZone.style.position = 'relative';
  
  // Handle file selection
  mobile3dFileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file && file.type === 'application/pdf') {
      if (file.size > 5 * 1024 * 1024) {
        alert('File size must be less than 5MB');
        mobile3dFileInput.value = '';
        return;
      }
      mobile3dFileName.textContent = file.name;
      mobile3dFileSize.textContent = (file.size / 1024 / 1024).toFixed(2) + ' MB';
      mobile3dDropZone.style.display = 'none';
      mobile3dFilePreview.style.display = 'flex';
      console.log('‚úÖ [Mobile-3D] File selected:', file.name);
    } else {
      alert('Please select a PDF file');
      mobile3dFileInput.value = '';
    }
  });
  
  // Remove file
  if (mobile3dFileRemove) {
    mobile3dFileRemove.addEventListener('click', (e) => {
      e.stopPropagation();
      mobile3dFileInput.value = '';
      mobile3dDropZone.style.display = 'flex';
      mobile3dFilePreview.style.display = 'none';
      console.log('‚ùå [Mobile-3D] File removed');
    });
  }
  
  console.log('‚úÖ [Mobile-3D] File upload handler ready');
}

// ===== FORM SUBMISSION HANDLER FOR MOBILE-3D =====
const mobile3dForm = document.getElementById('mobile-application-form');
if (mobile3dForm) {
  mobile3dForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const submitBtn = mobile3dForm.querySelector('.submit-button');
    const originalText = submitBtn.textContent;
    
    submitBtn.textContent = 'Submitting...';
    submitBtn.disabled = true;
    
    try {
      // Check if Supabase is ready
      if (!window.supabaseClient) {
        throw new Error('Supabase not initialized. Please refresh the page.');
      }
      
      // Get form data
      const formData = new FormData(mobile3dForm);
      const data = {
        name: formData.get('name'),
        email: formData.get('email'),
        phone: formData.get('phone'),
        game: formData.get('game'),
        rank: formData.get('rank'),
        game_id: formData.get('game_id')
      };
      
      console.log('üìù [Mobile-3D] Submitting application:', data);
      
      // Handle file upload if exists
      let portfolioUrl = null;
      let portfolioName = null;
      let portfolioSize = null;
      
      if (mobile3dFileInput && mobile3dFileInput.files.length > 0) {
        const file = mobile3dFileInput.files[0];
        console.log('üìÑ [Mobile-3D] Uploading file:', file.name);
        
        // Upload to Supabase Storage
        const fileName = `${Date.now()}_${file.name}`;
        const { data: uploadData, error: uploadError } = await window.supabaseClient
          .storage
          .from('portfolios')
          .upload(fileName, file);
        
        if (uploadError) {
          console.error('‚ùå File upload error:', uploadError);
          throw new Error('Failed to upload file: ' + uploadError.message);
        }
        
        console.log('‚úÖ File uploaded:', uploadData);
        
        // Get public URL
        const { data: urlData } = window.supabaseClient
          .storage
          .from('portfolios')
          .getPublicUrl(fileName);
        
        portfolioUrl = urlData.publicUrl;
        portfolioName = file.name;
        portfolioSize = (file.size / 1024 / 1024).toFixed(2) + ' MB';
        
        console.log('üîó File URL:', portfolioUrl);
      }
      
      // Insert into database
      const { data: dbData, error: dbError } = await window.supabaseClient
        .from('applications')
        .insert([{
          ...data,
          portfolio_url: portfolioUrl,
          portfolio_name: portfolioName,
          portfolio_size: portfolioSize
        }])
        .select();
      
      if (dbError) {
        console.error('‚ùå Database error:', dbError);
        throw new Error('Failed to submit application: ' + dbError.message);
      }
      
      console.log('‚úÖ Application saved:', dbData);
      
      // Success!
      alert('‚úÖ Application submitted successfully! We\'ll review it and get back to you soon.');
      mobile3dForm.reset();
      
      // Reset file upload UI
      if (mobile3dFilePreview && mobile3dDropZone) {
        mobile3dFilePreview.style.display = 'none';
        mobile3dDropZone.style.display = 'flex';
      }
      
      formModal.style.display = 'none';
      document.body.style.overflow = 'auto';
      
    } catch (error) {
      console.error('‚ùå [Mobile-3D] Submission error:', error);
      alert('‚ùå Failed to submit: ' + error.message + '\n\nPlease try again or contact us directly.');
    } finally {
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    }
  });
}

console.log('‚úÖ Mobile-3D template ready with file upload');
</script>