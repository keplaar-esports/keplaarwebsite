<!-- ============================================ -->
<!-- DESKTOP TEMPLATE - Clean & Modern Form -->
<!-- ============================================ -->

<!-- Intro UI Container -->
<div id="ui-container">
  <!-- Video Background -->
  <div id="video-background">
    <video id="bg-video" src="assets/textures/background.mp4" autoplay muted loop playsinline preload="auto"></video>
  </div>

  <!-- Intro Panel -->
  <div id="ui-panel-1">
    <img src="assets/textures/logo.png" alt="Keplaar Esports Logo" class="logo">
    <h1>KEPLAAR ESPORTS</h1>
    <h2>Version 2.0 | Canada 2025</h2>
    <button id="enter-button">Enter Environment</button>
  </div>
</div>

<!-- Navigation UI -->
<div id="navigation-ui" style="display: none;">
  <button id="previous-button"></button>
  <button id="next-button"></button>
</div>

<!-- Website Header -->
<header id="website-header" style="display: none;">
  <div class="header-left">
    <a href="#" id="logo-link">
      <img src="assets/textures/logo.png" alt="Keplaar Esports Logo" class="header-logo">
      <span class="header-title">KEPLAAR ESPORTS</span>
    </a>
  </div>
  
  <nav class="header-right">
    <ul class="nav-menu">
      <li><a href="#" data-screen="events">Events</a></li>
      <li><a href="#" data-screen="about">About Us</a></li>
      <li><a href="#" data-screen="team">Our Team</a></li>
      <li><a href="#" data-screen="giveaways">Giveaways</a></li>
      <li><a href="#" data-screen="join">Join Us</a></li>
    </ul>
  </nav>
</header>

<!-- Social Media UI -->
<div id="social-media-ui" class="blurred-ui" style="display: none;">
  <div class="ui-content">
    <button class="close-button">&times;</button>
    <h2>Follow Us</h2>
    <p class="subtitle">Stay connected with Keplaar Esports</p>
    
    <div class="social-grid">
      <div class="social-item" data-platform="instagram">
        <div class="social-logo">
          <img src="assets/icons/instagram.png" alt="Instagram" class="social-icon">
        </div>
        <span class="social-name">Instagram</span>
        <span class="social-handle">@keplaaresports</span>
      </div>
      
      <div class="social-item" data-platform="twitter">
        <div class="social-logo">
          <img src="assets/icons/x.png" alt="Twitter/X" class="social-icon">
        </div>
        <span class="social-name">Twitter/X</span>
        <span class="social-handle">@keplaaresports</span>
      </div>
      
      <div class="social-item" data-platform="youtube">
        <div class="social-logo">
          <img src="assets/icons/youtube.png" alt="YouTube" class="social-icon">
        </div>
        <span class="social-name">YouTube</span>
        <span class="social-handle">Keplaar Esports</span>
      </div>
      
      <div class="social-item" data-platform="discord">
        <div class="social-logo">
          <img src="assets/icons/discord.png" alt="Discord" class="social-icon">
        </div>
        <span class="social-name">Discord</span>
        <span class="social-handle">Join our community</span>
      </div>
    </div>
    
    <button id="next-to-form">
      Continue to Contact Form
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </div>
</div>

<!-- Contact Form UI -->
<div id="contact-form-ui" class="blurred-ui" style="display: none;">
  <div class="ui-content form-container-new">
    <button class="close-button">&times;</button>
    
    <!-- Form Content -->
    <div class="new-form-content">
      <div class="new-form-header">
        <h2>Join Keplaar Esports</h2>
        <p class="new-form-subtitle">Apply to become part of our competitive gaming team</p>
      </div>
      
      <form id="player-application-form" class="new-application-form">
        <!-- Row 1: Name and Email -->
        <div class="form-row">
          <div class="form-field">
            <label for="player-name">
              <span class="label-icon">üë§</span>
              <span class="label-text">Full Name</span>
              <span class="required-mark">*</span>
            </label>
            <input type="text" id="player-name" name="name" required placeholder="Enter your full name">
          </div>

          <div class="form-field">
            <label for="player-email">
              <span class="label-icon">‚úâÔ∏è</span>
              <span class="label-text">Email Address</span>
              <span class="required-mark">*</span>
            </label>
            <input type="email" id="player-email" name="email" required placeholder="you@example.com">
          </div>
        </div>

        <!-- Row 2: Phone and Game -->
        <div class="form-row">
          <div class="form-field">
            <label for="player-phone">
              <span class="label-icon">üì±</span>
              <span class="label-text">Phone Number</span>
              <span class="required-mark">*</span>
            </label>
            <input type="tel" id="player-phone" name="phone" required placeholder="+1 (123) 456-7890">
          </div>

          <div class="form-field">
            <label for="player-game">
              <span class="label-icon">üéÆ</span>
              <span class="label-text">Primary Game</span>
              <span class="required-mark">*</span>
            </label>
            
            <div class="custom-select-wrapper">
              <div class="custom-select-display" id="game-select-display">
                <span class="select-placeholder">Select your primary game</span>
                <span class="select-arrow-icon">‚ñº</span>
              </div>
              
              <div class="custom-select-dropdown" id="game-select-dropdown">
                <div class="select-option" data-value="valorant" data-icon="üéØ">
                  <span class="opt-icon">üéØ</span>
                  <span class="opt-label">VALORANT</span>
                </div>
                <div class="select-option" data-value="fortnite" data-icon="üèπ">
                  <span class="opt-icon">üèπ</span>
                  <span class="opt-label">Fortnite</span>
                </div>
                <div class="select-option" data-value="dota2" data-icon="‚öîÔ∏è">
                  <span class="opt-icon">‚öîÔ∏è</span>
                  <span class="opt-label">Dota 2</span>
                </div>
                <div class="select-option" data-value="pubg" data-icon="üî´">
                  <span class="opt-icon">üî´</span>
                  <span class="opt-label">PUBG</span>
                </div>
              </div>
              
              <select id="player-game" name="game" required style="display: none;">
                <option value="" disabled selected></option>
                <option value="valorant">VALORANT</option>
                <option value="fortnite">Fortnite</option>
                <option value="dota2">Dota 2</option>
                <option value="pubg">PUBG</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Row 3: Rank and Game ID -->
        <div class="form-row">
          <div class="form-field">
            <label for="player-rank">
              <span class="label-icon">üèÜ</span>
              <span class="label-text">Current Rank</span>
              <span class="required-mark">*</span>
            </label>
            <input type="text" id="player-rank" name="rank" required placeholder="e.g., Radiant, Immortal, Diamond">
          </div>

          <div class="form-field">
            <label for="player-id">
              <span class="label-icon">üéØ</span>
              <span class="label-text">In-Game ID</span>
              <span class="required-mark">*</span>
            </label>
            <input type="text" id="player-id" name="game_id" required placeholder="Your username in the game">
          </div>
        </div>

        <!-- Row 4: File Upload (Full Width) -->
        <div class="form-field full-width">
          <label for="player-portfolio">
            <span class="label-icon">üìÅ</span>
            <span class="label-text">Portfolio/Highlights</span>
            <span class="optional-mark">(Optional)</span>
          </label>
          
          <div class="new-file-upload">
            <div class="file-drop-zone" id="new-file-drop">
              <div class="drop-zone-icon">üìÑ</div>
              <div class="drop-zone-text">
                <span class="drop-main">Drag & drop your PDF here</span>
                <span class="drop-sub">or click to browse ‚Ä¢ Max 5MB</span>
              </div>
              <input type="file" 
                     id="player-portfolio" 
                     name="portfolio" 
                     accept=".pdf,.PDF" 
                     class="file-input-hidden">
            </div>
            
            <div class="file-preview" id="new-file-preview" style="display: none;">
              <div class="preview-icon">üìÑ</div>
              <div class="preview-details">
                <span class="preview-name" id="new-file-name"></span>
                <span class="preview-size" id="new-file-size"></span>
              </div>
              <button type="button" class="preview-remove" id="new-file-remove">‚úï</button>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="new-submit-btn">
          <span class="submit-text">Submit Application</span>
          <span class="submit-loading" style="display: none;">
            <span class="loading-spinner"></span>
            Processing...
          </span>
        </button>
        
        <p class="form-footer-note">* Required fields</p>
      </form>
    </div>
  </div>
</div>

<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/config/supabase.js"></script>

<!-- Form Handlers Script -->
<script>
console.log('üéØ Desktop template loaded');

// Wait for DOM and initialize
setTimeout(() => {
    console.log('‚è±Ô∏è Starting form setup...');
    
    // ===== DROPDOWN HANDLER =====
    const setupDropdown = () => {
        console.log('üîç Looking for dropdown elements...');
        
        const selectDisplay = document.getElementById('game-select-display');
        const selectDropdown = document.getElementById('game-select-dropdown');
        const hiddenSelect = document.getElementById('player-game');
        const placeholder = selectDisplay?.querySelector('.select-placeholder');
        
        console.log('Dropdown elements:', {
            display: selectDisplay ? 'FOUND' : 'NOT FOUND',
            dropdown: selectDropdown ? 'FOUND' : 'NOT FOUND',
            hidden: hiddenSelect ? 'FOUND' : 'NOT FOUND',
            placeholder: placeholder ? 'FOUND' : 'NOT FOUND'
        });
        
        if (!selectDisplay || !selectDropdown) {
            console.log('‚ö†Ô∏è Dropdown not ready, retrying in 300ms...');
            setTimeout(setupDropdown, 300);
            return;
        }
        
        console.log('‚úÖ All dropdown elements found!');
        console.log('Display element:', selectDisplay);
        console.log('Dropdown element:', selectDropdown);
        
        // Add pointer cursor to make it obvious it's clickable
        selectDisplay.style.cursor = 'pointer';
        
        // Click to toggle - USE MOUSEDOWN for better reliability
        selectDisplay.addEventListener('mousedown', (e) => {
            e.preventDefault();
            e.stopPropagation();
            console.log('üñ±Ô∏è DISPLAY CLICKED!');
            
            const isOpen = selectDisplay.classList.toggle('open');
            selectDropdown.classList.toggle('open', isOpen);
            console.log('üìã Dropdown is now:', isOpen ? 'OPEN' : 'CLOSED');
        });
        
        // Also try regular click
        selectDisplay.addEventListener('click', (e) => {
            console.log('üëÜ Click event fired on display');
        });
        
        // Select option
        const options = document.querySelectorAll('.select-option');
        console.log('üìù Found', options.length, 'options');
        
        options.forEach((option, index) => {
            option.style.cursor = 'pointer';
            
            option.addEventListener('mousedown', (e) => {
                e.preventDefault();
                e.stopPropagation();
                
                const value = option.dataset.value;
                const icon = option.dataset.icon;
                const label = option.querySelector('.opt-label').textContent;
                
                console.log('‚úÖ Option selected:', value);
                
                placeholder.innerHTML = `${icon} ${label}`;
                placeholder.classList.add('selected');
                hiddenSelect.value = value;
                
                options.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                
                selectDisplay.classList.remove('open');
                selectDropdown.classList.remove('open');
            });
        });
        
        // Close on outside click
        document.addEventListener('mousedown', (e) => {
            if (!selectDisplay.contains(e.target) && !selectDropdown.contains(e.target)) {
                selectDisplay.classList.remove('open');
                selectDropdown.classList.remove('open');
            }
        });
        
        console.log('üéâ Dropdown setup complete!');
    };
    
    setupDropdown();
    
    // ===== FILE UPLOAD HANDLER =====
    const fileInput = document.getElementById('player-portfolio');
    const dropZone = document.getElementById('new-file-drop');
    const filePreview = document.getElementById('new-file-preview');
    const fileName = document.getElementById('new-file-name');
    const fileSize = document.getElementById('new-file-size');
    const fileRemove = document.getElementById('new-file-remove');
    
    if (fileInput && dropZone) {
        dropZone.addEventListener('click', () => fileInput.click());
        
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file && file.type === 'application/pdf') {
                if (file.size > 5 * 1024 * 1024) {
                    alert('File size must be less than 5MB');
                    fileInput.value = '';
                    return;
                }
                fileName.textContent = file.name;
                fileSize.textContent = (file.size / 1024 / 1024).toFixed(2) + ' MB';
                dropZone.style.display = 'none';
                filePreview.style.display = 'flex';
            } else {
                alert('Please select a PDF file');
                fileInput.value = '';
            }
        });
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-active');
        });
        
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-active'));
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-active');
            const file = e.dataTransfer.files[0];
            if (file && file.type === 'application/pdf') {
                fileInput.files = e.dataTransfer.files;
                fileInput.dispatchEvent(new Event('change'));
            }
        });
        
        if (fileRemove) {
            fileRemove.addEventListener('click', (e) => {
                e.stopPropagation();
                fileInput.value = '';
                dropZone.style.display = 'flex';
                filePreview.style.display = 'none';
            });
        }
    }
    
    // NOTE: Form submission is handled by uiManager.js
    // File upload UI is managed here, submission logic is in uiManager.js
    
    // ===== CLOSE BUTTONS =====
    document.querySelector('#contact-form-ui .close-button')?.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        window.app?.uiManager?.hideAllUI();
    });
    
    document.querySelector('#social-media-ui .close-button')?.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        window.app?.uiManager?.hideAllUI();
    });
    
    // Click outside to close
    ['social-media-ui', 'contact-form-ui'].forEach(id => {
        const element = document.getElementById(id);
        element?.addEventListener('click', (e) => {
            if (e.target === element) window.app?.uiManager?.hideAllUI();
        });
    });
    
    console.log('‚úÖ All handlers ready');
}, 500);
</script>
